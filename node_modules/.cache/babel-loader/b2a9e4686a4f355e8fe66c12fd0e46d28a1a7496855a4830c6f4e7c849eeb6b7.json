{"ast":null,"code":"import _regeneratorRuntime from\"/Users/paawankarwa/Desktop/projects/realtime-editor/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/paawankarwa/Desktop/projects/realtime-editor/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/paawankarwa/Desktop/projects/realtime-editor/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useRef,useEffect}from'react';import toast from'react-hot-toast';import ACTIONS from'../Actions';import Client from'../components/Client';import Editor from'../components/Editor';import{initSocket}from'../socket';import{useLocation,useNavigate,Navigate,useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var roomIDTemp=null;var EditorPage=function EditorPage(){var socketRef=useRef(null);var codeRef=useRef(null);var location=useLocation();var _useParams=useParams(),roomId=_useParams.roomId;roomIDTemp=roomId;var reactNavigator=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];var called=0;useEffect(function(){if(called>=1){return;}called+=1;var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _location$state;var handleErrors;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:handleErrors=function _handleErrors(e){console.log('socket error',e);toast.error('Socket connection failed, try again later.');reactNavigator('/');};_context.next=3;return initSocket();case 3:socketRef.current=_context.sent;socketRef.current.on('connect_error',function(err){return handleErrors(err);});socketRef.current.on('connect_failed',function(err){return handleErrors(err);});socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});// Listening for joined event\nsocketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state2;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});});// Listening for disconnected\nsocketRef.current.on(ACTIONS.DISCONNECTED,function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});case 9:case\"end\":return _context.stop();}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){if(socketRef.current!=null){socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);socketRef.current.disconnect();}};},[]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;console.log(roomIDTemp);_context2.next=4;return navigator.clipboard.writeText(roomIDTemp);case 4:toast.success('Room ID has been copied to your clipboard');_context2.next=11;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);toast.error('Could not copy the Room ID');console.error(_context2.t0);case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,7]]);}));return _copyRoomId.apply(this,arguments);}function leaveRoom(){reactNavigator('/');}if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:\"/code-sync.png\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId);})})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;}})})]});};export default EditorPage;","map":{"version":3,"names":["React","useState","useRef","useEffect","toast","ACTIONS","Client","Editor","initSocket","useLocation","useNavigate","Navigate","useParams","jsx","_jsx","jsxs","_jsxs","roomIDTemp","EditorPage","socketRef","codeRef","location","_useParams","roomId","reactNavigator","_useState","_useState2","_slicedToArray","clients","setClients","called","init","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_location$state","handleErrors","wrap","_callee$","_context","prev","next","_handleErrors","e","console","log","error","current","sent","on","err","emit","JOIN","username","state","JOINED","_ref2","_location$state2","socketId","success","concat","SYNC_CODE","code","DISCONNECTED","_ref3","filter","client","stop","apply","arguments","off","disconnect","copyRoomId","_copyRoomId","_callee2","_callee2$","_context2","navigator","clipboard","writeText","t0","leaveRoom","to","className","children","src","alt","map","onClick","onCodeChange"],"sources":["/Users/paawankarwa/Desktop/projects/realtime-editor/src/pages/EditorPage.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport toast from 'react-hot-toast';\nimport ACTIONS from '../Actions';\nimport Client from '../components/Client';\nimport Editor from '../components/Editor';\nimport { initSocket } from '../socket';\nimport {\n    useLocation,\n    useNavigate,\n    Navigate,\n    useParams,\n} from 'react-router-dom';\n\nvar roomIDTemp = null;\nconst EditorPage = () => {\n    const socketRef = useRef(null);\n    const codeRef = useRef(null);\n    const location = useLocation();\n    const { roomId } = useParams();\n    roomIDTemp = roomId;\n    const reactNavigator = useNavigate();\n    const [clients, setClients] = useState([]);\n    var called = 0;\n    useEffect(() => {\n        if(called>=1){\n            return;\n        }\n        called += 1;\n        const init = async () => {\n            socketRef.current = await initSocket();\n            socketRef.current.on('connect_error', (err) => handleErrors(err));\n            socketRef.current.on('connect_failed', (err) => handleErrors(err));\n\n            function handleErrors(e) {\n                console.log('socket error', e);\n                toast.error('Socket connection failed, try again later.');\n                reactNavigator('/');\n            }\n\n            socketRef.current.emit(ACTIONS.JOIN, {\n                roomId,\n                username: location.state?.username,\n            });\n            \n            // Listening for joined event\n            socketRef.current.on(\n                ACTIONS.JOINED,\n                ({ clients, username, socketId }) => {\n                    if (username !== location.state?.username) {\n                        toast.success(`${username} joined the room.`);\n                        console.log(`${username} joined`);\n                    }\n                    setClients(clients);\n                    socketRef.current.emit(ACTIONS.SYNC_CODE, {\n                        code: codeRef.current,\n                        socketId,\n                    });\n                }\n            );\n\n            // Listening for disconnected\n            socketRef.current.on(\n                ACTIONS.DISCONNECTED,\n                ({ socketId, username }) => {\n                    toast.success(`${username} left the room.`);\n                    setClients((prev) => {\n                        return prev.filter(\n                            (client) => client.socketId !== socketId\n                        );\n                    });\n                }\n            );\n        };\n        init();\n        return () => {\n            if(socketRef.current != null){\n                socketRef.current.off(ACTIONS.JOINED);\n                socketRef.current.off(ACTIONS.DISCONNECTED);\n                socketRef.current.disconnect();\n            \n            }\n            \n        };\n    }, []);\n\n    async function copyRoomId() {\n        try {\n            console.log(roomIDTemp);\n            await navigator.clipboard.writeText(roomIDTemp);\n            toast.success('Room ID has been copied to your clipboard');\n        } catch (err) {\n            toast.error('Could not copy the Room ID');\n            console.error(err);\n        }\n    }\n\n    function leaveRoom() {\n        reactNavigator('/');\n    }\n\n    if (!location.state) {\n        return <Navigate to=\"/\" />;\n    }\n\n    return (\n        <div className=\"mainWrap\">\n            <div className=\"aside\">\n                <div className=\"asideInner\">\n                    <div className=\"logo\">\n                        <img\n                            className=\"logoImage\"\n                            src=\"/code-sync.png\"\n                            alt=\"logo\"\n                        />\n                    </div>\n                    <h3>Connected</h3>\n                    <div className=\"clientsList\">\n                        {clients.map((client) => (\n                            <Client\n                                key={client.socketId}\n                                username={client.username}\n                            />\n                        ))}\n                    </div>\n                </div>\n                <button className=\"btn copyBtn\" onClick={copyRoomId}>\n                    Copy ROOM ID\n                </button>\n                <button className=\"btn leaveBtn\" onClick={leaveRoom}>\n                    Leave\n                </button>\n            </div>\n            <div className=\"editorWrap\">\n                <Editor\n                    socketRef={socketRef}\n                    roomId={roomId}\n                    onCodeChange={(code) => {\n                        codeRef.current = code;\n                    }}\n                />\n            </div>\n        </div>\n    );\n};\n\nexport default EditorPage;"],"mappings":"2aAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,MAAM,CAAEC,SAAS,KAAQ,OAAO,CAC1D,MAAO,CAAAC,KAAK,KAAM,iBAAiB,CACnC,MAAO,CAAAC,OAAO,KAAM,YAAY,CAChC,MAAO,CAAAC,MAAM,KAAM,sBAAsB,CACzC,MAAO,CAAAC,MAAM,KAAM,sBAAsB,CACzC,OAASC,UAAU,KAAQ,WAAW,CACtC,OACIC,WAAW,CACXC,WAAW,CACXC,QAAQ,CACRC,SAAS,KACN,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAE1B,GAAI,CAAAC,UAAU,CAAG,IAAI,CACrB,GAAM,CAAAC,UAAU,CAAG,QAAb,CAAAA,UAAUA,CAAA,CAAS,CACrB,GAAM,CAAAC,SAAS,CAAGjB,MAAM,CAAC,IAAI,CAAC,CAC9B,GAAM,CAAAkB,OAAO,CAAGlB,MAAM,CAAC,IAAI,CAAC,CAC5B,GAAM,CAAAmB,QAAQ,CAAGZ,WAAW,CAAC,CAAC,CAC9B,IAAAa,UAAA,CAAmBV,SAAS,CAAC,CAAC,CAAtBW,MAAM,CAAAD,UAAA,CAANC,MAAM,CACdN,UAAU,CAAGM,MAAM,CACnB,GAAM,CAAAC,cAAc,CAAGd,WAAW,CAAC,CAAC,CACpC,IAAAe,SAAA,CAA8BxB,QAAQ,CAAC,EAAE,CAAC,CAAAyB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAAnCG,OAAO,CAAAF,UAAA,IAAEG,UAAU,CAAAH,UAAA,IAC1B,GAAI,CAAAI,MAAM,CAAG,CAAC,CACd3B,SAAS,CAAC,UAAM,CACZ,GAAG2B,MAAM,EAAE,CAAC,CAAC,CACT,OACJ,CACAA,MAAM,EAAI,CAAC,CACX,GAAM,CAAAC,IAAI,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA,MAAAC,eAAA,IAKA,CAAAC,YAAY,QAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAAZL,YAAY,UAAAM,cAACC,CAAC,CAAE,CACrBC,OAAO,CAACC,GAAG,CAAC,cAAc,CAAEF,CAAC,CAAC,CAC9BzC,KAAK,CAAC4C,KAAK,CAAC,4CAA4C,CAAC,CACzDxB,cAAc,CAAC,GAAG,CAAC,CACvB,CAAC,CAAAiB,QAAA,CAAAE,IAAA,SARyB,CAAAnC,UAAU,CAAC,CAAC,QAAtCW,SAAS,CAAC8B,OAAO,CAAAR,QAAA,CAAAS,IAAA,CACjB/B,SAAS,CAAC8B,OAAO,CAACE,EAAE,CAAC,eAAe,CAAE,SAACC,GAAG,QAAK,CAAAd,YAAY,CAACc,GAAG,CAAC,GAAC,CACjEjC,SAAS,CAAC8B,OAAO,CAACE,EAAE,CAAC,gBAAgB,CAAE,SAACC,GAAG,QAAK,CAAAd,YAAY,CAACc,GAAG,CAAC,GAAC,CAQlEjC,SAAS,CAAC8B,OAAO,CAACI,IAAI,CAAChD,OAAO,CAACiD,IAAI,CAAE,CACjC/B,MAAM,CAANA,MAAM,CACNgC,QAAQ,EAAAlB,eAAA,CAAEhB,QAAQ,CAACmC,KAAK,UAAAnB,eAAA,iBAAdA,eAAA,CAAgBkB,QAC9B,CAAC,CAAC,CAEF;AACApC,SAAS,CAAC8B,OAAO,CAACE,EAAE,CAChB9C,OAAO,CAACoD,MAAM,CACd,SAAAC,KAAA,CAAqC,KAAAC,gBAAA,IAAlC,CAAA/B,OAAO,CAAA8B,KAAA,CAAP9B,OAAO,CAAE2B,QAAQ,CAAAG,KAAA,CAARH,QAAQ,CAAEK,QAAQ,CAAAF,KAAA,CAARE,QAAQ,CAC1B,GAAIL,QAAQ,KAAAI,gBAAA,CAAKtC,QAAQ,CAACmC,KAAK,UAAAG,gBAAA,iBAAdA,gBAAA,CAAgBJ,QAAQ,EAAE,CACvCnD,KAAK,CAACyD,OAAO,IAAAC,MAAA,CAAIP,QAAQ,qBAAmB,CAAC,CAC7CT,OAAO,CAACC,GAAG,IAAAe,MAAA,CAAIP,QAAQ,WAAS,CAAC,CACrC,CACA1B,UAAU,CAACD,OAAO,CAAC,CACnBT,SAAS,CAAC8B,OAAO,CAACI,IAAI,CAAChD,OAAO,CAAC0D,SAAS,CAAE,CACtCC,IAAI,CAAE5C,OAAO,CAAC6B,OAAO,CACrBW,QAAQ,CAARA,QACJ,CAAC,CAAC,CACN,CACJ,CAAC,CAED;AACAzC,SAAS,CAAC8B,OAAO,CAACE,EAAE,CAChB9C,OAAO,CAAC4D,YAAY,CACpB,SAAAC,KAAA,CAA4B,IAAzB,CAAAN,QAAQ,CAAAM,KAAA,CAARN,QAAQ,CAAEL,QAAQ,CAAAW,KAAA,CAARX,QAAQ,CACjBnD,KAAK,CAACyD,OAAO,IAAAC,MAAA,CAAIP,QAAQ,mBAAiB,CAAC,CAC3C1B,UAAU,CAAC,SAACa,IAAI,CAAK,CACjB,MAAO,CAAAA,IAAI,CAACyB,MAAM,CACd,SAACC,MAAM,QAAK,CAAAA,MAAM,CAACR,QAAQ,GAAKA,QAAQ,EAC5C,CAAC,CACL,CAAC,CAAC,CACN,CACJ,CAAC,CAAC,wBAAAnB,QAAA,CAAA4B,IAAA,MAAAjC,OAAA,GACL,kBA5CK,CAAAL,IAAIA,CAAA,SAAAC,IAAA,CAAAsC,KAAA,MAAAC,SAAA,OA4CT,CACDxC,IAAI,CAAC,CAAC,CACN,MAAO,WAAM,CACT,GAAGZ,SAAS,CAAC8B,OAAO,EAAI,IAAI,CAAC,CACzB9B,SAAS,CAAC8B,OAAO,CAACuB,GAAG,CAACnE,OAAO,CAACoD,MAAM,CAAC,CACrCtC,SAAS,CAAC8B,OAAO,CAACuB,GAAG,CAACnE,OAAO,CAAC4D,YAAY,CAAC,CAC3C9C,SAAS,CAAC8B,OAAO,CAACwB,UAAU,CAAC,CAAC,CAElC,CAEJ,CAAC,CACL,CAAC,CAAE,EAAE,CAAC,CAAC,QAEQ,CAAAC,UAAUA,CAAA,SAAAC,WAAA,CAAAL,KAAA,MAAAC,SAAA,YAAAI,YAAA,EAAAA,WAAA,CAAA1C,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAzB,SAAAyC,SAAA,SAAA1C,mBAAA,GAAAK,IAAA,UAAAsC,UAAAC,SAAA,iBAAAA,SAAA,CAAApC,IAAA,CAAAoC,SAAA,CAAAnC,IAAA,SAAAmC,SAAA,CAAApC,IAAA,GAEQI,OAAO,CAACC,GAAG,CAAC9B,UAAU,CAAC,CAAC6D,SAAA,CAAAnC,IAAA,SAClB,CAAAoC,SAAS,CAACC,SAAS,CAACC,SAAS,CAAChE,UAAU,CAAC,QAC/Cb,KAAK,CAACyD,OAAO,CAAC,2CAA2C,CAAC,CAACiB,SAAA,CAAAnC,IAAA,iBAAAmC,SAAA,CAAApC,IAAA,GAAAoC,SAAA,CAAAI,EAAA,CAAAJ,SAAA,aAE3D1E,KAAK,CAAC4C,KAAK,CAAC,4BAA4B,CAAC,CACzCF,OAAO,CAACE,KAAK,CAAA8B,SAAA,CAAAI,EAAI,CAAC,CAAC,yBAAAJ,SAAA,CAAAT,IAAA,MAAAO,QAAA,gBAE1B,UAAAD,WAAA,CAAAL,KAAA,MAAAC,SAAA,GAED,QAAS,CAAAY,SAASA,CAAA,CAAG,CACjB3D,cAAc,CAAC,GAAG,CAAC,CACvB,CAEA,GAAI,CAACH,QAAQ,CAACmC,KAAK,CAAE,CACjB,mBAAO1C,IAAA,CAACH,QAAQ,EAACyE,EAAE,CAAC,GAAG,CAAE,CAAC,CAC9B,CAEA,mBACIpE,KAAA,QAAKqE,SAAS,CAAC,UAAU,CAAAC,QAAA,eACrBtE,KAAA,QAAKqE,SAAS,CAAC,OAAO,CAAAC,QAAA,eAClBtE,KAAA,QAAKqE,SAAS,CAAC,YAAY,CAAAC,QAAA,eACvBxE,IAAA,QAAKuE,SAAS,CAAC,MAAM,CAAAC,QAAA,cACjBxE,IAAA,QACIuE,SAAS,CAAC,WAAW,CACrBE,GAAG,CAAC,gBAAgB,CACpBC,GAAG,CAAC,MAAM,CACb,CAAC,CACD,CAAC,cACN1E,IAAA,OAAAwE,QAAA,CAAI,WAAS,CAAI,CAAC,cAClBxE,IAAA,QAAKuE,SAAS,CAAC,aAAa,CAAAC,QAAA,CACvB1D,OAAO,CAAC6D,GAAG,CAAC,SAACrB,MAAM,qBAChBtD,IAAA,CAACR,MAAM,EAEHiD,QAAQ,CAAEa,MAAM,CAACb,QAAS,EADrBa,MAAM,CAACR,QAEf,CAAC,EACL,CAAC,CACD,CAAC,EACL,CAAC,cACN9C,IAAA,WAAQuE,SAAS,CAAC,aAAa,CAACK,OAAO,CAAEhB,UAAW,CAAAY,QAAA,CAAC,cAErD,CAAQ,CAAC,cACTxE,IAAA,WAAQuE,SAAS,CAAC,cAAc,CAACK,OAAO,CAAEP,SAAU,CAAAG,QAAA,CAAC,OAErD,CAAQ,CAAC,EACR,CAAC,cACNxE,IAAA,QAAKuE,SAAS,CAAC,YAAY,CAAAC,QAAA,cACvBxE,IAAA,CAACP,MAAM,EACHY,SAAS,CAAEA,SAAU,CACrBI,MAAM,CAAEA,MAAO,CACfoE,YAAY,CAAE,SAAAA,aAAC3B,IAAI,CAAK,CACpB5C,OAAO,CAAC6B,OAAO,CAAGe,IAAI,CAC1B,CAAE,CACL,CAAC,CACD,CAAC,EACL,CAAC,CAEd,CAAC,CAED,cAAe,CAAA9C,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}